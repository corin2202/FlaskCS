{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename = 'styles.css')}}">

<form method="GET" class="sort-form">
    <label for="sort_by">Sort by:</label>
    <select name="sort_by" id="sort_by" onchange="this.form.submit()">
        <option value="">-- Select --</option>
        <option value ="priceup">Price ascending</option>
        <option value="pricedown">Price descending</option>
        <option value ="footprintup">Least environmental impact</option>
        <option value="footprintdown">Most environmental impact</option>
    </select>
</form>

{% for title, pizzas in pizzaDict.items() %}
<div class="title-slider">
    <h1 class="pizza-type">{{ title }}</h1>
    <div class="image-slider">
        <div class="slider-track">
            {% for pizza in pizzas %}
            <div class="pizza-card">
                <a href="{{ url_for('singleProductPage', pizzaName = pizza.name )}}">
                    <img class="homepizza" src="{{ url_for('static', filename = 'img/' + pizza.image) }}" data-id = "{{ pizza.id }}">
                </a>
                <p class="image-text">{{ pizza.name }} - {{ pizza.price }}</p>

                <form method="POST">
                    <input type="hidden" name="pizza_id" value="{{ pizza.id }}">
                    <input type="hidden" name="increase" value="true">
                    <button type="submit">+</button>
                </form>

                <p>Carbon footprint: {{ pizza.footprint }}</p>
            </div>

            {% endfor %}
        </div>

    </div>

</div>

{% endfor %}
{% endblock %}

{% block scripts %}
<script>

    var imgs = document.querySelectorAll(".homepizza");
    imgs.forEach(function(img) {
        img.addEventListener("mouseover", retrieveInfo);
        img.addEventListener("mouseout", removeInfo);
    });
    
    async function retrieveInfo(event) {
        var pizzaId = event.target.getAttribute("data-id");
        console.log(pizzaId);

        try {
            const response = await fetch(`/pizza-info/${pizzaId}`);
            const data = await response.text();
            displayInfo(data, pizzaId, event.target);
        } catch (error) {
            console.error("Error fetching info");
        }
    }

    function displayInfo(data, id, img) {
        var div = document.createElement("div");
        var text = document.createElement("p");
        text.innerText = data;
        div.appendChild(text);

        img._infoDiv = div;
        img.parentElement.appendChild(div); 
    }

    function removeInfo(event) {
        
        var div = event.target._infoDiv;
        if (div) {
            div.remove();  
            delete event.target._infoDiv;  
        }
    }

</script>
{% endblock %}